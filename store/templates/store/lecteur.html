<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lecteur Audio Moderne</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
/* Styles simplifiés pour le lecteur */
#playlist-player {
    width: 100%;
    max-width: 500px;
    padding: 20px;
    background-color: #f8f8f8;
    border-radius: 12px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    font-family: Arial, sans-serif;
}

.track-info {
    display: flex;
    align-items: center;
    margin-bottom: 15px;
}

.track-info img {
    width: 60px;
    height: 60px;
    border-radius: 6px;
    margin-right: 15px;
}

.track-info .text {
    display: flex;
    flex-direction: column;
}

.track-info .text span {
    font-weight: bold;
}

.controls {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 10px;
}

.controls button {
    background: none;
    border: none;
    font-size: 20px;
    margin: 0 10px;
    cursor: pointer;
}

#seek-bar, #volume-bar {
    width: 100%;
    margin: 5px 0;
}

#playlist {
    list-style-type: none;
    padding: 0;
}

#playlist li {
    cursor: pointer;
    padding: 5px;
    border-bottom: 1px solid #ddd;
}

#playlist li:hover {
    background-color: #eee;
}
</style>
</head>
<body>

<div id="playlist-player">
    <div class="track-info">
        <!-- Image corrigée -->
        <img id="track-img" src="{{ track.cover_image.url }}" alt="Image du track">
        <div class="text">
            <span id="track-title">{{ track.title }}</span>
            <span id="track-artist">{{ track.artist.name }}</span>
        </div>
    </div>

    <audio id="audio-element">
        <source src="{{ track.file.url }}" type="audio/mpeg">
        Votre navigateur ne supporte pas la lecture audio.
    </audio>

    <div class="controls">
        <button id="prev-btn"><i class="fa fa-backward"></i></button>
        <button id="play-pause-btn"><i class="fa fa-play"></i></button>
        <button id="next-btn"><i class="fa fa-forward"></i></button>
    </div>

    <input type="range" id="seek-bar" value="0">
    <input type="range" id="volume-bar" min="0" max="1" step="0.01" value="1">

    <ul id="playlist">
        <!-- Exemple d’élément de playlist corrigé -->
        <li data-src="{{ track.file.url }}" 
            data-img="{{ track.cover_image.url }}" 
            data-title="{{ track.title }}" 
            data-artist="{{ track.artist.name }}">
            {{ track.title }} - {{ track.artist.name }}
        </li>
        <!-- Ajouter d'autres morceaux ici -->
    </ul>
</div>

<script>
const audio = document.getElementById('audio-element');
const playPauseBtn = document.getElementById('play-pause-btn');
const prevBtn = document.getElementById('prev-btn');
const nextBtn = document.getElementById('next-btn');
const seekBar = document.getElementById('seek-bar');
const volumeBar = document.getElementById('volume-bar');
const playlist = document.getElementById('playlist');

const trackImg = document.getElementById('track-img');
const trackTitle = document.getElementById('track-title');
const trackArtist = document.getElementById('track-artist');

let currentTrack = 0;

function loadTrack(index) {
    const tracks = playlist.getElementsByTagName('li');
    if (index >= 0 && index < tracks.length) {
        currentTrack = index;
        const track = tracks[currentTrack];
        audio.src = track.getAttribute('data-src');
        trackImg.src = track.getAttribute('data-img');
        trackTitle.textContent = track.getAttribute('data-title');
        trackArtist.textContent = track.getAttribute('data-artist');
        audio.load();
        playPauseBtn.innerHTML = '<i class="fa fa-play"></i>';
    }
}

function playPause() {
    if (audio.paused) {
        audio.play();
        playPauseBtn.innerHTML = '<i class="fa fa-pause"></i>';
    } else {
        audio.pause();
        playPauseBtn.innerHTML = '<i class="fa fa-play"></i>';
    }
}

playPauseBtn.addEventListener('click', playPause);

prevBtn.addEventListener('click', () => {
    loadTrack(currentTrack - 1);
    audio.play();
    playPauseBtn.innerHTML = '<i class="fa fa-pause"></i>';
});

nextBtn.addEventListener('click', () => {
    loadTrack(currentTrack + 1);
    audio.play();
    playPauseBtn.innerHTML = '<i class="fa fa-pause"></i>';
});

audio.addEventListener('timeupdate', () => {
    const progress = (audio.currentTime / audio.duration) * 100;
    seekBar.value = progress || 0;
});

seekBar.addEventListener('input', () => {
    const time = (seekBar.value / 100) * audio.duration;
    audio.currentTime = time;
});

volumeBar.addEventListener('input', () => {
    audio.volume = volumeBar.value;
});

playlist.addEventListener('click', (e) => {
    if (e.target.tagName === 'LI') {
        const tracks = playlist.getElementsByTagName('li');
        loadTrack([...tracks].indexOf(e.target));
        audio.play();
        playPauseBtn.innerHTML = '<i class="fa fa-pause"></i>';
    }
});

loadTrack(0);
</script>
</body>
</html>
